module('WikiParser.js').requires('ometa/parser.js').toRun(function() {
WikiParser=Object.delegated(Parser,{"nl":function(){var $elf=this;return $elf._applyWithArgs("exactly","\n")},"createTextSpec":function(){var $elf=this;return (function (){var spec=({"string": "","attributes": []});spec["assemble"]=(function (){var morph=new TextMorph(new Rectangle((0),(0),(10),(10)));morph.applyStyle(({"fill": Color["white"],"borderWidth": (0),"opacity": (0),"fontSize": (16)}));var text=new lively.Text.Text(spec["string"]);spec["attributes"].forEach((function (ea){text.emphasize(ea,ea["start"],ea["stop"])}));morph.setRichText(text);return morph});spec["add"]=(function (str){spec["string"]+=str});spec["addAttribute"]=(function (attr){spec["attributes"].push(attr)});spec["addAttributed"]=(function (str,attribute){attribute["start"]=spec["string"]["length"];spec.add(str);attribute["stop"]=spec["string"]["length"];spec.addAttribute(attribute)});return spec})()},"heading":function(){var $elf=this,start,c,cs,end;return (function(){start=$elf._many1(function(){return $elf._applyWithArgs("exactly","=")});cs=$elf._many1(function(){return (function(){$elf._not(function(){return $elf._applyWithArgs("exactly","\n")});$elf._not(function(){return $elf._applyWithArgs("exactly","=")});c=$elf._apply("char");return c})()});end=$elf._many1(function(){return $elf._applyWithArgs("exactly","=")});$elf._pred((end["length"] == start["length"]));return (function (){var morph=new TextMorph(new Rectangle((0),(0),(10),(10)),cs.join(""));morph.applyStyle(({"fill": Color["white"],"borderWidth": (0),"opacity": (0),"fontSize": ((40) - (start["length"] * (6)))}));return morph})()})()},"paragraph":function(){var $elf=this,spec;return (function(){spec=$elf._apply("createTextSpec");$elf._many1(function(){return $elf._applyWithArgs("atomicText",spec)});return spec.assemble()})()},"nestableText":function(){var $elf=this,spec;return (function(){spec=$elf._apply("anything");return $elf._or((function(){return $elf._applyWithArgs("atomicText",spec)}),(function(){return $elf._applyWithArgs("list",spec)}))})()},"list":function(){var $elf=this,spec,level;return (function(){spec=$elf._apply("anything");level=$elf._many1(function(){return $elf._applyWithArgs("exactly","*")});$elf._apply("spaces");(function (){spec.add(level.collect((function (ea){return "\t"})).join(""));return spec.add("â€¢ ")})();$elf._many1(function(){return (function(){$elf._not(function(){return $elf._applyWithArgs("exactly","\n")});return $elf._or((function(){return $elf._applyWithArgs("bold",spec)}),(function(){return $elf._applyWithArgs("italic",spec)}),(function(){return $elf._applyWithArgs("link",spec)}),(function(){return $elf._applyWithArgs("wordsNoNewline",spec)}))})()});$elf._or((function(){return $elf._applyWithArgs("exactly","\n")}),(function(){return $elf._apply("end")}));spec.add("\n");return $elf._many(function(){return $elf._applyWithArgs("list",spec)})})()},"atomicText":function(){var $elf=this,spec;return (function(){spec=$elf._apply("anything");return $elf._or((function(){return $elf._applyWithArgs("wordsNoParagraphEnd",spec)}),(function(){return $elf._applyWithArgs("bold",spec)}),(function(){return $elf._applyWithArgs("italic",spec)}),(function(){return $elf._applyWithArgs("link",spec)}),(function(){return $elf._applyWithArgs("list",spec)}))})()},"character":function(){var $elf=this,spec,c;return (function(){spec=$elf._apply("anything");c=$elf._apply("char");return spec.add(c)})()},"wordsNoParagraphEnd":function(){var $elf=this,spec,c;return (function(){spec=$elf._apply("anything");return $elf._many1(function(){return (function(){$elf._not(function(){return $elf._apply("paragraphEnd")});c=$elf._apply("char");$elf._pred(((((c != "*") && (c != "[")) && (c != "<")) && (c != "\'")));return spec.add(c)})()})})()},"wordsNoNewline":function(){var $elf=this,spec,c;return (function(){spec=$elf._apply("anything");return $elf._many1(function(){return (function(){c=$elf._apply("char");$elf._pred((((((c != "\n") && (c != "*")) && (c != "[")) && (c != "<")) && (c != "\'")));return spec.add(c)})()})})()},"bold":function(){var $elf=this,spec,c,cs;return (function(){spec=$elf._apply("anything");$elf._not(function(){return $elf._apply("space")});$elf._applyWithArgs("token","\'\'\'");cs=$elf._many1(function(){return (function(){$elf._not(function(){return $elf._applyWithArgs("token","\'\'\'")});c=$elf._apply("char");return c})()});$elf._applyWithArgs("token","\'\'\'");return spec.addAttributed(cs.join(""),({"style": "bold"}))})()},"italic":function(){var $elf=this,spec,c,cs;return (function(){spec=$elf._apply("anything");$elf._not(function(){return $elf._apply("space")});$elf._applyWithArgs("token","\'\'");cs=$elf._many1(function(){return (function(){$elf._not(function(){return $elf._applyWithArgs("token","\'\'")});c=$elf._apply("char");return c})()});$elf._applyWithArgs("token","\'\'");return spec.addAttributed(cs.join(""),({"style": "italic"}))})()},"link":function(){var $elf=this,spec,c,target,c,name;return (function(){spec=$elf._apply("anything");$elf._applyWithArgs("exactly","[");target=$elf._many1(function(){return (function(){$elf._not(function(){return $elf._applyWithArgs("exactly","]")});$elf._not(function(){return $elf._apply("space")});c=$elf._apply("char");return c})()});name=$elf._or((function(){return (function(){$elf._many1(function(){return $elf._apply("space")});return $elf._many1(function(){return (function(){$elf._not(function(){return $elf._applyWithArgs("exactly","]")});c=$elf._apply("char");return c})()})})()}),(function(){return (function(){$elf._apply("empty");return []})()}));$elf._applyWithArgs("exactly","]");return spec.addAttributed((name.join("") || target.join("")),({"link": target.join(""),"color": "blue"}))})()},"paragraphEnd":function(){var $elf=this;return (function(){$elf._applyWithArgs("exactly","\n");return $elf._or((function(){return $elf._many1(function(){return $elf._applyWithArgs("exactly","\n")})}),(function(){return $elf._applyWithArgs("exactly","=")}))})()},"partEnd":function(){var $elf=this;return $elf._or((function(){return $elf._many1(function(){return $elf._applyWithArgs("exactly","\n")})}),(function(){return $elf._apply("end")}))},"textParts":function(){var $elf=this,p;return $elf._many1(function(){return (function(){p=$elf._or((function(){return $elf._apply("heading")}),(function(){return $elf._apply("paragraph")}));$elf._apply("partEnd");return p})()})},"log":function(){var $elf=this,msg;return (function(){msg=$elf._apply("anything");return console.log(msg)})()},"wikiTextDescription":function(){var $elf=this,parts;return (function(){parts=$elf._apply("textParts");$elf._apply("end");return parts})()}})
});